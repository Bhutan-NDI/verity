deploy-k8s:
  extends:
    - .verity-main-only-rule
  stage: deploy
  script:
    - ls verity/target/verity-application*.deb
    - export debianPackage=`ls verity/target/verity-application*.deb`
    - >
      if [ ! -z "${debianPackage}" ]; then
        export VERITY_VERSION=`echo "$debianPackage" | cut -d'_' -f2`
      else
        /bin/false
      fi
    - curl
      --request POST
      --form token=$TRIGGER_API_K8S_TOKEN
      --form ref=master
      --form "variables[VERITY_APPLICATION_VERSION]=$VERITY_VERSION"
      $TRIGGERAPI_URL_VERITY_K8S_RELEASE
  tags:
    - docker-machine
  environment:
    name: verity-k8s-release
  needs: ["package" ,"publish-debian", "publish-docker"]
